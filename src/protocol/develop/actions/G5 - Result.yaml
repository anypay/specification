#
# Result Action: Once a vote has been completed the results are published. After the result is posted, it is up to the administration to send a contract/asset amendement if appropriate.
#

code: G5
version: 1

metadata:
  name: Result
  label: Result
  description: "Once a vote has been completed the results are published. After the result is posted, it is up to the administration to send a contract/asset amendement if appropriate."
  validation: None
  rejection: Rejection

  inputs:
    - name: Contract
      label: Contract Public Address
      comments: "The contract that is performing this action."

  outputs:
    - name: Contract
      label: Contract Public Address
      comments: "Required so that users can monitor transactions to the contract for notifications of this action."

fields:
  - name: AssetSpecificVote
    label: Asset Specific Vote
    description: "When true this proposal is specific to an asset and the asset type and asset code fields are serialized."
    type: bool

  - name: AssetType
    label: Asset Type
    description: "Three letter character that specifies the asset type."
    type: fixedchar
    size: 3
    example: "SHC"
    # includeIfTrue specifies that this field is only included in serialization if the specified field is true.
    includeIfTrue: AssetSpecificVote

  - name: AssetCode
    label: Asset Code
    description: A unique code that is used to identify the asset. It is generated by hashing the contract public key hash and the asset index. SHA256(contract PKH + asset index)
    type: AssetCode
    notes: "Cannot be changed by the administration, operator or smart contract."
    # includeIfTrue specifies that this field is only included in serialization if the specified field is true.
    includeIfTrue: AssetSpecificVote

  - name: Specific
    label: Specific
    description: "When true the ProposedAmendments field is included and specifies the exact changes to make to the Contract/Asset on chain. When false this is just a general proposal like a strategy/direction and doesn't result in any on chain update."
    type: bool

  - name: ProposedAmendments
    label: Proposed Amendments
    description: "Each element contains details of which fields to modify, or delete. Because the number of fields in a Contract and Asset is dynamic due to some fields being able to be repeated, the index value of the field needs to be calculated against the Contract or Asset the changes are to apply to. In the event of a Vote being created from this Initiative, the changes will be applied to the version of the Contract or Asset at that time."
    type: Amendment[]
    # includeIfTrue specifies that this field is only included in serialization if the specified field is true.
    includeIfTrue: Specific

  - name: VoteTxId
    label: Vote Tx ID
    description: "Link to the Vote Action txn."
    type: TxId
    example: "f13386211d04591ffee918b8506236688f3ced9b1dfde77142bfc24a5e29b2bd"

  - name: OptionTally
    label: Option Tally
    description: "List of number of valid votes counted for each vote option. Length is encoded like a regular list object, but must match the length of VoteOptions from the Proposal action."
    type: uint64[]
    size: 1

  - name: Result
    label: Result
    description: "Length 1-255 bytes. 0 is not valid. The Option with the most votes. In the event of a draw for 1st place, all winning options are listed."
    type: varchar
    # varchar size is number of bytes to serialize the size of the value
    size: 1

  - name: Timestamp
    label: Timestamp
    description: "Timestamp in nanoseconds of when the smart contract created the action."
    type: Timestamp
    example: "Wed May 09 2018 00:00:00 GMT+1000 (AEST)"
    notes: "Cannot be changed by the administration, operator. Smart contract controls."
