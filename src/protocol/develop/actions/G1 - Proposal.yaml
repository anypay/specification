#
# Proposal Action: Allows the Administration/Token Holders to propose a change (aka Initiative/Shareholder vote).  A significant cost - specified in the Contract Formation - can be attached to this action when sent from Token Holders to reduce spam, as the resulting vote will be put to all token owners.
#

code: G1
version: 1

metadata:
  name: Proposal
  label: Proposal
  description: "Allows the Administration/Token Holders to propose a change (aka Initiative/Shareholder vote).  A significant cost - specified in the Contract Formation - can be attached to this action when sent from Token Holders to reduce spam, as the resulting vote will be put to all token owners."
  validation: Contract/Asset Amendment or nothing
  rejection: Rejection

  inputs:
    - name: User
      label: "Operator / Token Owner's Public Address"
      comments: "The user making the proposal for this contract."

  outputs:
    - name: Contract
      label: Contract Public Address
      comments: Includes contract fee and holder proposal fee if applicable.

    - name: Contract
      label: Contract Public Address
      comments: Fund the Result TX at Vote cut off

fields:
  - name: Initiator
    label: Initiator
    description: "Who initiated the proposal. Supported values: 0 - Administration, 1 - Holder"
    type: uint
    size: 1
    intValues:
      - 0
      - 1

  - name: AssetSpecificVote
    label: Asset Specific Vote
    description: "When true this proposal is specific to an asset and the asset type and asset code fields are serialized."
    type: bool

  - name: AssetType
    label: Asset Type
    description: "Three letter character that specifies the asset type."
    type: fixedchar
    size: 3
    example: "SHC"
    # includeIfTrue specifies that this field is only included in serialization if the specified field is true.
    includeIfTrue: AssetSpecificVote

  - name: AssetCode
    label: Asset Code
    description: A unique code that is used to identify the asset. It is generated by hashing the contract public key hash and the asset index. SHA256(contract PKH + asset index)
    type: AssetCode
    notes: "Cannot be changed by the administration, operator or smart contract."
    # includeIfTrue specifies that this field is only included in serialization if the specified field is true.
    includeIfTrue: AssetSpecificVote

  - name: VoteSystem
    label: Vote System
    description: "X for Vote System X. (1-255, 0 is not valid.)"
    type: uint
    size: 1
    example: "1"

  - name: Specific
    label: Specific
    description: "When true the ProposedAmendments field is included and specifies the exact changes to make to the contract/asset on chain. When false this is just a general proposal like a strategy/direction and doesn't result in any on chain update."
    type: bool

  - name: ProposedAmendments
    label: Proposed Amendments
    description: "Each element contains details of which fields to modify, or delete. Because the number of fields in a Contract and Asset is dynamic due to some fields being able to be repeated, the index value of the field needs to be calculated against the Contract or Asset the changes are to apply to. In the event of a Vote being created from this Initiative, the changes will be applied to the version of the Contract or Asset at that time."
    type: Amendment[]
    # includeIfTrue specifies that this field is only included in serialization if the specified field is true.
    includeIfTrue: Specific

  - name: VoteOptions
    label: Vote Options
    description: "Length 1-255 bytes. 0 is not valid. Each byte allows for a different vote option. Typical votes will likely be multiple choice or Y/N. Vote instances are identified by the Tx-ID. AB would be used for Y/N (binary) type votes. When Specific is true, only AB is a valid value."
    type: varchar
    # varchar size is number of bytes to serialize the size of the value
    size: 1
    example: "ABCDEFGHIJKLMNO"

  - name: VoteMax
    label: Vote Max
    description: "Range: 1-X. How many selections can a voter make in a Ballot Cast. 1 is selected for Y/N (binary). When Specific is true, only 1 is a valid value."
    type: uint
    size: 1
    example: "15"

  - name: ProposalDescription
    label: Proposal Description
    description: "Length restricted by the Bitcoin protocol. 0 is valid. Description or details of the vote"
    type: varchar
    # varchar size is number of bytes to serialize the size of the value
    size: 4
    example: "Change the name of the Contract."

  - name: ProposalDocumentHash
    label: Proposal Document Hash
    description: "SHA256 Hash of the proposal document to be distributed to voters."
    type: bin
    size: 32
    example: "77201b0094f50df309f0343e4f44dae64d0de503c91038faf2c6b039f9f18aec"

  - name: VoteCutOffTimestamp
    label: Vote Cut-Off Timestamp
    description: "Ballot casts after this timestamp will not be included. The vote has finished."
    type: Timestamp
    example: "Wed May 09 2018 00:00:00 GMT+1000 (AEST)"
